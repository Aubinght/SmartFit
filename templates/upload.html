{% extends "template.html" %}

{% block title %}Upload - SmartFit{% endblock %}

{% block content %}
<style>
    /* --- Styles spécifiques à l'Upload uniquement --- */
    .upload-container {
        background-color: #f9f9f9;
        padding: 30px;
        border-radius: 10px;
        border: 1px solid #ddd;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        text-align: center;
    }

    .preview-img {
        max-width: 250px;
        height: auto;
        border-radius: 10px;
        border: 3px solid #86b9bb;
        margin-bottom: 20px;
    }

    .flash-messages {
        list-style: none;
        padding: 10px;
        margin-bottom: 20px;
        border-radius: 5px;
    }
    .flash-error { 
        background-color: #f8d7da; 
        color: #721c24; 
    }
    .flash-success { 
        background-color: #d4edda; 
        color: #155724; 
    }

    select {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        margin: 10px 0;
        width: 100%;
        max-width: 300px;
    }

    .step-title { 
        color: #2c3e50; 
        margin-bottom: 20px; 
    }

    button {
        background-color: #86b9bb;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: 0.3s;
    }
    button:hover { 
        background-color: #628bb6; 
    }
</style>

<div class="upload-section">
    <h1>Add clothes to your wardrobe</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <ul class="flash-messages flash-{{ category }}">
            <li>{{ message }}</li>
          </ul>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="upload-container">
        {% if not show_confirmation %}
            <h2 class="step-title">Step 1 : Upload your item</h2>
            <form method="POST" action="{{ url_for('upload') }}" enctype="multipart/form-data">            
                <input type="file" name="file" required>
                <br><br>
                <button type="submit">Upload and analyze</button>
            </form>
        {% endif %}

        {% if show_confirmation and filepath and predicted_category %}
            <h2 class="step-title">Step 2 : Confirm category</h2>
            
            {% set img_filename = filepath.split('/')[-1] %}
            <img src="{{ url_for('static', filename='uploads/' + img_filename) }}" 
                 alt="Garment to confirm" class="preview-img">
            
            <p>Color detected: <strong style="color: {{ predicted_color }};">{{ predicted_color }}</strong></p>
            <p>The model detected : <strong>{{ predicted_category }}</strong>. Is it correct ?</p>
            
            <form method="POST" action="{{ url_for('confirm_add') }}">
                <input type="hidden" name="filepath" value="{{ filepath }}">
                <input type="hidden" name="item_color" value="{{ item_color }}">
                
                <label for="final_category">Final category :</label><br>
                <select name="final_category" id="final_category" required>
                    {% for cat in categories %}
                        <option value="{{ cat }}" {% if cat|lower == predicted_category|lower %}selected{% endif %}>
                            {{ cat }} {% if cat|lower == predicted_category|lower %}(Detected){% endif %}
                        </option>
                    {% endfor %}
                </select>
                <br>
                <label for="final_color">Correct color :</label><br>
                <select name="final_color" id="final_color" required>
                    {% for col in colors %}
                        <option value="{{ col }}" {% if col|lower == predicted_category|lower %}selected{% endif %}>
                            {{ col }} {% if col|lower == predicted_color|lower %}(Detected){% endif %}
                        </option>
                    {% endfor %}
                </select>
                <br><br>
                <button type="submit">Confirm and add to the wardrobe</button>
            </form>
        {% endif %}
    </div>
    
    <p style="margin-top: 30px; text-align: center;">
        <a href="{{ url_for('wardrobe') }}" style="color: #333; text-decoration: none; font-weight: bold;">← Back to wardrobe</a>
    </p>
</div>
{% endblock %}
